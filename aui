#!/bin/bash
#-------------------------------------------------------------------------------
#Created by helmuthdu mailto: helmuthdu[at]gmail[dot]com
#Inspired by Andreas Freitag, aka nexxx script
#-------------------------------------------------------------------------------
#This program is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.
#
#This program is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with this program.  If not, see <http://www.gnu.org/licenses/>.
#-------------------------------------------------------------------------------
# Run this script after your first boot with archlinux (as root)

source auiscript

KDE=0
LXDE=0
XFCE=0
GNOME=0
OPENBOX=0

YAOURT=0
PACKER=0

BASICSETUP=0
DESKTOPENVIRONMENT=0
ACCESSORIES=0
DEVELOPMENT=0
OFFICE=0
SYSTEM=0
GRAPHICS=0
INTERNET=0
AUDIO=0
VIDEO=0
LAMP=0
GAMES=0
FONTS=0
FONTSCONFIG=0
CLEANPACKAGES=0

ARCHI=`uname -m`

prompt1="Enter your option: "
prompt2="Enter nÂ° of options (ex: 1 2 3 or 1-3): "

function read_input(){ #{{{
    if [[ $USE_SCRIPT -eq 1 ]]; then
        OPTION=$1
    else
        read -p "$prompt1: " OPTION
    fi
} #}}}
function read_input_text(){ #{{{
    if [[ $USE_SCRIPT -eq 1 ]]; then
        OPTION=$2
    else
        read -p "$1 [y][N]: " OPTION
        echo ""
    fi
    OPTION=`echo "$OPTION" | tr '[:upper:]' '[:lower:]'`
} #}}}
function read_input_options(){ #{{{
    local line
    local packages
    if [[ $USE_SCRIPT -eq 1 ]]; then
        array=("$1")
    else
        read -p "$prompt2" OPTION
        array=("$OPTION")
    fi
    for line in ${array[@]/,/ }; do
        if [[ ${line/-/} != $line ]]; then
            for ((i=${line%-*}; i<=${line#*-}; i++)); do
                packages+=($i);
            done
        else
            packages+=($line)
        fi
    done
    OPTIONS=("${packages[@]}")
} #}}}
function print_line(){ #{{{
    printf "%$(tput cols)s\n"|tr ' ' '-'
} #}}}
function print_title (){ #{{{
    clear
    print_line
    echo -e "# $1"
    print_line
    echo ""
} #}}}
function remove_daemon(){ #{{{
    sed -i '/DAEMONS[=]/s/ '"$1"'//' /etc/rc.conf
} #}}}
function replace_daemon(){ #{{{
    sed -i '/DAEMONS[=]/s/'"$1"'/'"$2"'/' /etc/rc.conf
} #}}}
function start_daemon(){ #{{{
    DAEMON_LIST=`echo "$1" | sed 's/@//g'`
    for DAEMON in $DAEMON_LIST; do
        ! ls -1 /var/run/daemons/$DAEMON &> /dev/null && rc.d start $DAEMON;
    done
} #}}}
function add_daemon(){ #{{{
    remove_daemon "$1"
    sed -i '/DAEMONS[=]/s/\(.*\)\>/& '"$1"'/' /etc/rc.conf
    start_daemon "$1"
} #}}}
function remove_module(){ #{{{
    sed -i '/MODULES[=]/s/ '"$1"'//' /etc/rc.conf
} #}}}
function start_module(){ #{{{
    for MODULE in $1; do
        modprobe $MODULE;
    done
} #}}}
function add_module(){ #{{{
    remove_module "$1"
    sed -i '/MODULES[=]/s/\(.*\)\>/& '"$1"'/' /etc/rc.conf
    #sed -i '/MODULES[=]/s/^[^ ]*\>/& '"$1"'/' /etc/rc.conf
    start_module "$1"
} #}}}
function config_dm(){ #{{{
    sed -i '/'"$1"'/s/^#//' /etc/inittab
    sed -i '/xdm/s/^#//' /etc/inittab
    sed -i '/xdm/s/^/#/' /etc/inittab
    sed -i '/id:3:initdefault/s/^#//' /etc/inittab
    sed -i '/id:3:initdefault/s/^/#/' /etc/inittab
    sed -i '/id:5:initdefault/s/^#//' /etc/inittab
} #}}}
function check_package(){ #{{{
    for PACKAGE in $1; do
        if pacman -Q $PACKAGE &>/dev/null; then
            return 0
        fi
    done
    return 1
} #}}}
function checkbox(){ #{{{
    [[ $1 -eq 1 ]] && echo "[X]" || echo "[ ]";
} #}}}
function checkbox_package(){ #{{{
    if check_package "$1"; then
        checkbox 1
    else
        checkbox 0
    fi
} #}}}
function aur_package_install(){ #{{{
    for PACKAGE in $1; do
        if ! check_package "$PACKAGE" ; then
            if [[ $YAOURT -eq 1 ]]; then
                su -l $USERNAME --command="yaourt -S --noconfirm $PACKAGE"
            else
                su -l $USERNAME --command="packer -S --noconfirm $PACKAGE"
            fi
            #RECHECK #{{{
            if ! check_package "$PACKAGE" ; then
                if [[ $USE_SCRIPT -eq 1 ]]; then
                    echo "$PACKAGE" >> packages_not_installed.txt
                else
                    read_input_text "Package $PACKAGE not installed, try install again?"
                    if [[ $OPTION == y ]]; then
                        if [[ $YAOURT -eq 1 ]]; then
                            su -l $USERNAME --command="yaourt -S $PACKAGE"
                        else
                            su -l $USERNAME --command="packer -S $PACKAGE"
                        fi
                    fi
                fi
            fi
            #}}}
        else
            echo -e "Warning: $PACKAGE is up to date --skipping"
        fi
    done
} #}}}
function package_install(){ #{{{
    if [[ $USE_SCRIPT -eq 1 ]]; then
        pacman -S --noconfirm --needed $1
    else
        pacman -S --needed $1
    fi
} #}}}
function package_remove(){ #{{{
    if [[ $USE_SCRIPT -eq 1 ]]; then
        pacman -Rsn --noconfirm $1
    else
        pacman -Rsn $1
    fi
} #}}}
function contains_element(){ #{{{
    for e in "${@:2}"; do [[ $e == $1 ]] && break; done;
} #}}}
function invalid_option(){ #{{{
    print_line
    echo "Invalid option. Try another one."
    pause_function
} #}}}
function pause_function(){ #{{{
    print_line
    if [[ $USE_SCRIPT -ne 1 ]]; then
        read -e -sn 1 -p "Press any key to continue..."
    fi
} #}}}
function sumary(){ #{{{
    case $CURRENT_STATUS in
        1)
            print_line
            echo "$1 successful"
            ;;
        *)
            print_line
            echo "$1 not successful (Canceled)"
            ;;
    esac
} #}}}
function elihw() { #{{{
    [[ $OPT == b || $OPT == d ]] && break;
} #}}}

#WELCOME {{{
function welcome(){
    clear
    echo "Welcome to the Archlinux Ultimate install script by helmuthdu"
    print_line
    echo "Requirements:"
    echo "-> Archlinux installation"
    echo "-> Run script as root user"
    echo "-> Working internet connection"
    print_line
    echo "Script can be cancelled at any time with CTRL+C"
    print_line
    echo "it's highly recommended that you read this script before using it"
    echo "This version is still in BETA. Send bugreports to: "
    echo "http://www.github.com/helmuthdu/aui"
    print_line
    echo -e "\nSystem config backup:"
    print_line
    [[ ! -f /etc/rc.conf.aui ]] && cp -v /etc/rc.conf /etc/rc.conf.aui || echo "/etc/rc.conf.aui";
    [[ ! -f /etc/pacman.conf.aui ]] && cp -v /etc/pacman.conf /etc/pacman.conf.aui || echo "/etc/pacman.conf.aui";
    [[ ! -f /etc/inittab.aui ]] && cp -v /etc/inittab /etc/inittab.aui || echo "/etc/inittab.aui";
    [[ ! -f /etc/ssh/sshd_config.aui ]] && cp -v /etc/ssh/sshd_config /etc/ssh/sshd_config.aui || echo "/etc/ssh/sshd_conf.aui";
    [[ ! -f /etc/X11/xorg.conf.d/10-evdev.conf.aui ]] && cp -v /etc/X11/xorg.conf.d/10-evdev.conf /etc/X11/xorg.conf.d/10-evdev.conf.aui || echo "/etc/X11/xorg.conf.d/10-evdev.conf.aui";
    pause_function
}
#}}}
#CHECK ROOT {{{
function check_root() {
    CURRENTUSER="$(whoami)"
    if [[ $CURRENTUSER != root ]]; then
        echo "Current user is NOT 'root'. EXIT now"
        pause_function
        exit 1
    fi
}
#}}}
#LANGUAGE SELECTOR {{{
function language_selector(){
    #DETECTS THE SYSTEM LANGUAGE {{{
    #automatically detects the system language based on your rc.conf
    LANGUAGE=`cat /etc/rc.conf | sed -n '/LOCALE=/p' | sed '1!d' | sed 's/.*"\(.*\)".*/\1/g' | cut -c1-5`
    #KDE #{{{
    if [[ $LANGUAGE == pt_BR || $LANGUAGE == en_GB || $LANGUAGE == zh_CN ]]; then
        LANGUAGE_KDE=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]'`
    elif [[ $LANGUAGE == en_US ]]; then
        LANGUAGE_KDE="en_gb"
    else
        LANGUAGE_KDE=`echo $LANGUAGE | cut -d\_ -f1`
    fi
    #}}}
    #FIREFOX #{{{
    if [[ $LANGUAGE == pt_BR || $LANGUAGE == pt_PT || $LANGUAGE == en_GB || $LANGUAGE == es_AR || $LANGUAGE == es_ES || $LANGUAGE == zh_CN ]]; then
        LANGUAGE_FF=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]' | sed 's/_/-/'`
    elif [[ $LANGUAGE == en_US ]]; then
        LANGUAGE_FF="en-gb"
    else
        LANGUAGE_FF=`echo $LANGUAGE | cut -d\_ -f1`
    fi
    #}}}
    #HUNSPELL #{{{
    if [[ $LANGUAGE == pt_BR ]]; then
        LANGUAGE_HS=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]' | sed 's/_/-/'`
    elif [[ $LANGUAGE == pt_PT ]]; then
        LANGUAGE_HS="pt_pt"
    else
        LANGUAGE_HS=`echo $LANGUAGE | cut -d\_ -f1`
    fi
    #}}}
    #ASPELL #{{{
        LANGUAGE_AS=`echo $LANGUAGE | cut -d\_ -f1`
    #}}}
    #LIBREOFFICE #{{{
    if [[ $LANGUAGE == pt_BR || $LANGUAGE == en_GB || $LANGUAGE == en_US || $LANGUAGE == zh_CN ]]; then
        LANGUAGE_LO=`echo $LANGUAGE | sed 's/_/-/'`
    else
        LANGUAGE_LO=`echo $LANGUAGE | cut -d\_ -f1`
    fi
    #}}}
    #}}}
    print_title "LANGUAGE - https://wiki.archlinux.org/index.php/Locale"
    read_input_text "Default system language: \"$LANGUAGE\"" $LANGSELECT
    case "$OPTION" in
        "n")
            read -p "New system language [ex: en_US]: " LANGUAGE
            #KDE #{{{
            if [[ $LANGUAGE == pt_BR || $LANGUAGE == en_GB || $LANGUAGE == zh_CN ]]; then
                LANGUAGE_KDE=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]'`
            elif [[ $LANGUAGE == en_US ]]; then
                LANGUAGE_KDE="en_gb"
            else
                LANGUAGE_KDE=`echo $LANGUAGE | cut -d\_ -f1`
            fi
            #}}}
            #FIREFOX #{{{
            if [[ $LANGUAGE == pt_BR || $LANGUAGE == pt_PT || $LANGUAGE == en_GB || $LANGUAGE == es_AR || $LANGUAGE == es_ES || $LANGUAGE == zh_CN ]]; then
                LANGUAGE_FF=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]' | sed 's/_/-/'`
            elif [[ $LANGUAGE == en_US ]]; then
                LANGUAGE_FF="en-gb"
            else
                LANGUAGE_FF=`echo $LANGUAGE | cut -d\_ -f1`
            fi
            #}}}
            #HUNSPELL #{{{
            if [[ $LANGUAGE == pt_BR ]]; then
                LANGUAGE_HS=`echo $LANGUAGE | tr '[:upper:]' '[:lower:]' | sed 's/_/-/'`
            elif [[ $LANGUAGE == pt_PT ]]; then
                LANGUAGE_HS="pt_pt"
            else
                LANGUAGE_HS=`echo $LANGUAGE | cut -d\_ -f1`
            fi
            #}}}
            #ASPELL #{{{
            LANGUAGE_AS=`echo $LANGUAGE | cut -d\_ -f1`
            #}}}
            #LIBREOFFICE #{{{
            if [[ $LANGUAGE == pt_BR || $LANGUAGE == en_GB || $LANGUAGE == en_US || $LANGUAGE == zh_CN ]]; then
                LANGUAGE_LO=`echo $LANGUAGE | sed 's/_/-/'`
            else
                LANGUAGE_LO=`echo $LANGUAGE | cut -d\_ -f1`
            fi
            #}}}
            ;;
        *)
            ;;
    esac
    pause_function
}
#}}}
#CUSTOM REPOSITORIES {{{
function custom_repositories(){
    # ENABLE MULTILIB REPOSITORY {{{
    # this option will avoid any problem with packages install
    if [[ $ARCHI == x86_64 ]]; then
        local multilib=`grep -n "\[multilib\]" /etc/pacman.conf | cut -f1 -d:`
        sed -i "$multilib s/^#//g" /etc/pacman.conf
        local multilib=$(( $multilib + 2 ))
        sed -i "$multilib s/^#//g" /etc/pacman.conf
        pacman -Sy
    fi
    #}}}
    print_title "CUSTOM REPOSITORIES - https://wiki.archlinux.org/index.php/Unofficial_User_Repositories"
    read_input_text "Add custom repositories" $CUSTOMREPO
    case "$OPTION" in
        "y")
            #CUSTOM REPOSITORIES {{{
            while [[ 1 ]]
            do
                print_title "CUSTOM REPOSITORIES - https://wiki.archlinux.org/index.php/Unofficial_User_Repositories"
                echo " 1) \"Add new repository\""
                echo ""
                echo " d) DONE"
                echo ""
                CUSTOMREPO+=" d"
                read_input_options "$CUSTOMREPO"
                for OPT in ${OPTIONS[@]}; do
                    case $OPT in
                        1)
                            read -p "Repository Name [ex: custom]: " REPONAME
                            read -p "Repository Address [ex: file:///media/backup/Archlinux]: " REPOADDRESS
                            echo -e '\n['"$REPONAME"']\nServer = '"$REPOADDRESS"/'$arch' >> /etc/pacman.conf
                            echo -e '\nCustom repository added into pacman.conf file'
                            pause_function
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            pacman -Sy
            CURRENT_STATUS=1
            ;;
            #}}}
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Custom repositories configuration"
    pause_function
}
#}}}
#RANKMIRROR {{{
function rankmirror(){
    print_title "RANKMIRROR - https://wiki.archlinux.org/index.php/Improve_Pacman_Performance"
    read_input_text "Choosing the fastest mirror using rankmirror (this can take a while)"
    case "$OPTION" in
        "y")
            cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup
            sed -i '/^#\S/ s|#||' /etc/pacman.d/mirrorlist.backup
            rankmirrors -n 5 /etc/pacman.d/mirrorlist.backup > /etc/pacman.d/mirrorlist
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "New mirrorlist creation"
    pause_function
}
#}}}
#SYSTEM UPDATE {{{
function system_upgrade(){
    print_title "UPDATING YOUR SYSTEM"
    pacman -Syu
}
#}}}
#SELECT/CREATE USER {{{
function select_user(){
    create_new_user(){ #{{{
        read -p "Username: " USERNAME
        useradd -m -g users -G audio,lp,optical,storage,video,wheel,games,power,scanner,network -s /bin/bash $USERNAME
        passwd $USERNAME
        cp /etc/skel/.* /home/$USERNAME/
        #BASHRC {{{
            print_title "BASHRC - https://wiki.archlinux.org/index.php/Bashrc"
            package_install "git"
            git clone git://github.com/helmuthdu/dotfiles
            cp dotfiles/.* ~
            cp dotfiles/.* /home/$USERNAME/
            rm -fr dotfiles
            print_title "DEFAULT EDITOR"
            EDITOR=("Nano" "Vim");
            PS3="$prompt1"
            echo -e "Choose default editor\n"
            select OPT in "${EDITOR[@]}"; do
                case "$REPLY" in
                    1)
                        sed -i '/EDITOR/s/vim/nano/' /home/$USERNAME/.bashrc
                        sed -i '/VISUAL/s/vim/nano/' /home/$USERNAME/.bashrc
                        sed -i '/EDITOR/s/vim/nano/' ~/.bashrc
                        sed -i '/VISUAL/s/vim/nano/' ~/.bashrc
                        break
                        ;;
                    2)
                        # VIM
                        package_install "vim ctags ack"
                        if ! check_package "discount" ; then
                            su -l $USERNAME --command="
                                wget http://aur.archlinux.org/packages/discount/discount.tar.gz;
                                tar zxvf discount.tar.gz;
                                cd discount;
                                makepkg -si --noconfirm;
                                cd ..;
                                rm -fr discount*
                            "
                        fi
                        # VIMRC
                        git clone git://github.com/helmuthdu/vim
                        mv vim /home/$USERNAME/.vim
                        ln -sf /home/$USERNAME/.vim/vimrc /home/$USERNAME/.vimrc
                        # PENTADACTYL [FIREFOX]
                        git clone git://github.com/helmuthdu/pentadactyl
                        mv pentadactyl /home/$USERNAME/.pentadactyl
                        ln -sf /home/$USERNAME/.pentadactyl/pentadactylrc /home/$USERNAME/.pentadactylrc
                        break
                        ;;
                    *)
                        invalid_option
                        ;;
                esac
            done
            chown -R $USERNAME:users /home/$USERNAME/.*
        #}}}
    } #}}}
    print_title "SELECT USER ACCOUNT - https://wiki.archlinux.org/index.php/Users_and_Groups"
    users=(`cat /etc/passwd | grep "/home" | cut -d: -f1`);
    PS3="$prompt1"
    echo "Avaliable Users:"
    if [[ $(( ${#users[@]} )) -gt 0 ]]; then
        echo -e "WARNING: THE SELECTED USER MUST HAVE SUDO PRIVILEGES\n"
    else
        echo ""
    fi
    select OPT in "${users[@]}" "Create new user"; do
        if [ "$OPT" == "Create new user" ]; then
            create_new_user
            break
        elif contains_element "$OPT" "${users[@]}"; then
            USERNAME=$OPT
            break
        else
            invalid_option
        fi
    done
    #ENABLE SUDO {{{
    if ! check_package "sudo" ; then
        print_title "SUDO - https://wiki.archlinux.org/index.php/Sudo"
        package_install "sudo"
    fi
    ## Uncomment to allow members of group wheel to execute any command
    sed -i '/%wheel ALL=(ALL) ALL/s/^#//' /etc/sudoers
    ## Same thing without a password (not secure)
    #sed -i '/%wheel ALL=(ALL) NOPASSWD: ALL/s/^#//' /etc/sudoers
    #}}}
}
#}}}
#AUR HELPER {{{
function choose_aurhelper(){
    print_title "AUR HELPER - https://wiki.archlinux.org/index.php/AUR_Helpers"
    aurhelper=("Yaourt" "Packer")
    PS3="$prompt1"
    echo -e "Choose your default AUR helper to install\n"
    select OPT in "${aurhelper[@]}"; do
        case "$REPLY" in
            1)
                if ! check_package "yaourt" ; then
                    package_install "base-devel yajl"
                    su -l $USERNAME --command="
                        wget http://aur.archlinux.org/packages/package-query/package-query.tar.gz;
                        tar zxvf package-query.tar.gz;
                        cd package-query;
                        makepkg -si --noconfirm;
                        cd ..;
                        rm -fr package-query*
                    "
                    su -l $USERNAME --command="
                        wget http://aur.archlinux.org/packages/yaourt/yaourt.tar.gz;
                        tar zxvf yaourt.tar.gz;
                        cd yaourt;
                        makepkg -si --noconfirm;
                        cd ..;
                        rm -fr yaourt*
                    "
                    if ! check_package "yaourt" ; then
                        echo "Yaourt not installed. EXIT now"
                        pause_function
                        exit 0
                    fi
                fi
                CURRENT_STATUS=1
                YAOURT=1
                break
                ;;
            2)
                if ! check_package "packer" ; then
                    package_install "base-devel git jshon curl"
                    su -l $USERNAME --command="
                        wget http://aur.archlinux.org/packages/pa/packer/packer.tar.gz;
                        tar zxvf packer.tar.gz;
                        cd packer;
                        makepkg -si --noconfirm;
                        cd ..;
                        rm -fr packer*
                    "
                    if ! check_package "packer" ; then
                        echo "Packer not installed. EXIT now"
                        pause_function
                        exit 0
                    fi
                fi
                CURRENT_STATUS=1
                PACKER=1
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
    sumary "AUR Helper installation"
    pause_function
}
#}}}
#PACKMAN PACKAGE SIGNING {{{
function pacman_package_signing(){
    print_title "PACMAN PACKAGE SIGNING - https://wiki.archlinux.org/index.php/Pacman-key"
    read_input_text "Automatically configure pacman package signing" $PACKAGESIGN
    case "$OPTION" in
        "y")
            package_install "base-devel"
            aur_package_install "rng-tools"
            sed -i '/timeout/s/0/10/' /etc/conf.d/rngd
            rngd -f -r /dev/urandom &
            pacman-key --init --keyserver pgp.mit.edu
            killall rngd
            package_remove "rng-tools"
            package_install "archlinux-keyring"
            #DEVELOPER AND TU KEYS {{{
            KEYS="y"
            read_input_text "Install Developer and TU Keys" $KEYS
            if [[ $OPTION == n ]]; then
                curl https://www.archlinux.org/{developers,trustedusers}/ |
                awk -F\" '(/pgp.mit.edu/) {sub(/.*search=0x/,"");print $1}' |
                xargs pacman-key --recv-keys
            fi
            #}}}
            sed -i '/SigLevel\ [=]\ Optional\ TrustAll/s/^#//' /etc/pacman.conf
            sed -i '/SigLevel\ [=]\ Never/s/^/#/' /etc/pacman.conf
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Pacman signing configuration"
    pause_function
}
#}}}
#BASIC SETUP{{{
function install_basic_setup(){
    print_title "BASH TOOLS - https://wiki.archlinux.org/index.php/Bash"
    package_install "bc rsync mlocate bash-completion net-tools"
    print_title "(UN)COMPRESS TOOLS - https://wiki.archlinux.org/index.php/P7zip"
    package_install "zip unzip unrar p7zip"
    aur_package_install "rar"
    print_title "DBUS - https://wiki.archlinux.org/index.php/D-Bus"
    package_install "dbus"
    add_daemon "dbus"
    print_title "AVAHI - https://wiki.archlinux.org/index.php/Avahi"
    package_install "avahi nss-mdns"
    add_daemon "avahi-daemon"
    print_title "ACPI - https://wiki.archlinux.org/index.php/ACPI_modules"
    package_install "acpi acpid"
    add_daemon "acpid"
    print_title "NTFS/FAT/exFAT - https://wiki.archlinux.org/index.php/Windows"
    package_install "ntfs-3g ntfsprogs dosfstools exfat-utils fuse fuse-exfat"
    print_title "SSH - https://wiki.archlinux.org/index.php/Ssh"
    package_install "rssh openssh"
    add_daemon "@sshd"
    #CONFIGURE SSHD_CONF #{{{
        sed -i '/ListenAddress/s/^#//' /etc/ssh/sshd_config
        sed -i '/SyslogFacility/s/^#//' /etc/ssh/sshd_config
        sed -i '/LogLevel/s/^#//' /etc/ssh/sshd_config
        sed -i '/LoginGraceTime/s/^#//' /etc/ssh/sshd_config
        sed -i '/PermitRootLogin/s/^#//' /etc/ssh/sshd_config
        sed -i '/StrictModes/s/^#//' /etc/ssh/sshd_config
        sed -i '/RSAAuthentication/s/^#//' /etc/ssh/sshd_config
        sed -i '/PubkeyAuthentication/s/^#//' /etc/ssh/sshd_config
        sed -i '/IgnoreRhosts/s/^#//' /etc/ssh/sshd_config
        sed -i '/PermitEmptyPasswords/s/^#//' /etc/ssh/sshd_config
        sed -i '/X11Forwarding/s/^#//' /etc/ssh/sshd_config
        sed -i '/X11Forwarding/s/no/yes/' /etc/ssh/sshd_config
        sed -i '/X11DisplayOffset/s/^#//' /etc/ssh/sshd_config
        sed -i '/X11UseLocalhost/s/^#//' /etc/ssh/sshd_config
        sed -i '/PrintMotd/s/^#//' /etc/ssh/sshd_config
        sed -i '/PrintMotd/s/yes/no/' /etc/ssh/sshd_config
        sed -i '/PrintLastLog/s/^#//' /etc/ssh/sshd_config
        sed -i '/TCPKeepAlive/s/^#//' /etc/ssh/sshd_config
        sed -i '/the setting of/s/^/#/' /etc/ssh/sshd_config
        sed -i '/RhostsRSAAuthentication and HostbasedAuthentication/s/^/#/' /etc/ssh/sshd_config
        sed -i '/ListenAddress\ ::/s/^/#/' /etc/ssh/sshd_config
    #}}}
    #SAMBA #{{{
    print_title "SAMBA - https://wiki.archlinux.org/index.php/Samba"
    read_input_text "Install Samba" $SAMBA
    case "$OPTION" in
        "y")
            package_install "samba"
            cp /etc/samba/smb.conf.default /etc/samba/smb.conf
            add_daemon "@samba"
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Samba installation"
    pause_function
    #}}}
    #NFS #{{{
    print_title "NFS - https://wiki.archlinux.org/index.php/Nfs"
    read_input_text "Install nfs" $NFS
    case "$OPTION" in
        "y")
            package_install "nfs-utils"
            add_daemon "rpcbind nfs-common nfs-server"
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Nfs installation"
    pause_function
    #}}}
    print_title "ALSA - https://wiki.archlinux.org/index.php/Alsa"
    package_install "alsa-utils alsa-plugins"
    sed -i '/MODULES[=]/s/snd-usb-audio//' /etc/rc.conf
    sed -i '/MODULES[=]/s/MODULES[=](/&snd-usb-audio/' /etc/rc.conf
    add_daemon "@alsa"
}
#}}}
#TLP #{{{
function install_tlp(){
    print_title "TLP - https://wiki.archlinux.org/index.php/TLP"
    read_input_text "Install TLP (Battery Improvement on Laptops)" $TLP
    case "$OPTION" in
        "y")
            package_install "upower"
            aur_package_install "tlp"
            add_daemon "@tlp"
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "TLP installation"
    pause_function
}
#}}}
#XORG {{{
function install_xorg(){
    print_title "XORG - https://wiki.archlinux.org/index.php/Xorg"
    echo "Installing X-Server (req. for Desktopenvironment, GPU Drivers, Keyboardlayout,...)"
    package_install "xorg-server xorg-xinit xorg-xkill"
    package_install "xf86-input-synaptics xf86-input-mouse xf86-input-keyboard"
    package_install "mesa"
    package_install "gamin"
    #CONFIGURE QWERTY KEYBOARD IN XORG {{{
    local file="/etc/X11/xorg.conf.d/10-evdev.conf"
    local line=`grep -n "keyboard" $file | cut -f1 -d:`
    local line=$(( $line + 2 ))
    local patch=`cat $file | sed ''$(( $line + 1 ))'!d'`
    local keymap=`cat /etc/rc.conf | sed -n '/KEYMAP[=]/p' | sed 's/.*"\(.*\)".*/\1/g'`

    if [[ $patch != *"XkbLayout"* ]]; then
        if [[ $keymap == us-acentos ]]; then
            kblayout="\\\tOption \"XkbLayout\" \"us_intl\""
            sed -i "${line}a $kblayout" $file
        else
            if [[ $LANGUAGE == pt_BR ]]; then
                kblayout="\\\tOption \"XkbLayout\" \"br\""
                kblayout+="\n\\tOption \"XkbVariant\" \"abnt2\""
                sed -i "${line}a $kblayout" $file
            elif [[ $LANGUAGE == fr_FR ]]; then
                kblayout="\\\tOption \"XkbLayout\" \"fr\""
                sed -i "${line}a $kblayout" $file
            fi
        fi
    fi
    #}}}
}
#}}}
#VIDEO CARDS {{{
function install_video_cards(){
    print_title "VIDEO CARD"
    echo "Select your GPU:"
    echo " 1) Intel"
    echo " 2) ATI"
    echo " 3) nVidia"
    echo " 4) Nouveau"
    echo " 5) Virtualbox"
    echo " 6) Vesa"
    echo ""
    echo " s) SKIP"
    echo ""
    read_input $VIDEOCARD
    case "$OPTION" in
        1)
            package_install "libgl xf86-video-intel"
            CURRENT_STATUS=1
            sumary "Intel GPU driver installation"
            ;;
        2)
            package_install "libgl xf86-video-ati"
            add_module "radeon"
            CURRENT_STATUS=1
            sumary "ATI GPU driver installation"
            ;;
        3)
            pacman -Rsn $(pacman -Qe | grep xf86-video | awk '{print $1}')
            pacman -S --needed nvidia nvidia-utils
            CURRENT_STATUS=1
            sumary "nVidia GPU driver installation"
            ;;
        4)
            package_install "libgl xf86-video-nouveau nouveau-dri"
            add_module "nouveau"
            CURRENT_STATUS=1
            sumary "Nouveau GPU driver installation"
            ;;
        5)
            package_install "virtualbox-archlinux-additions"
            add_module "vboxguest vboxsf vboxvideo"
            groupadd vboxsf
            gpasswd -a $USERNAME vboxsf
            CURRENT_STATUS=1
            sumary "Virtualbox guest additions (incl. video drivers) installation"
            ;;
        6)
            package_install "xf86-video-vesa"
            CURRENT_STATUS=1
            sumary "Vesa GPU driver installation"
            ;;
        *)
            CURRENT_STATUS=0
            sumary "GPU drivers installation"
            ;;
    esac
    pause_function
}
#}}}
#CUPS {{{
function install_cups(){
    print_title "CUPS - https://wiki.archlinux.org/index.php/Cups"
    read_input_text "Install CUPS (aka Common Unix Printing System)" $CUPS
    case "$OPTION" in
        "y")
            package_install "cups ghostscript gsfonts"
            package_install "gutenprint foomatic-db foomatic-db-engine foomatic-db-nonfree foomatic-filters hplip splix cups-pdf"
            add_daemon "@cupsd"
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "CUPS installation"
    pause_function
}
#}}}
#ADDITIONAL FIRMWARE {{{
function install_additional_firmwares(){
    print_title "INSTALL ADDITIONAL FIRMWARES"
    read_input_text "Install additional firmwares [Wireless,Bluetooth]" $FIRMWARE
    case "$OPTION" in
        "y")
            #ADDITIONAL FIRMWARE {{{
            while [[ 1 ]]
            do
                print_title "INSTALL ADDITIONAL FIRMWARES"
                echo " 1) $(checkbox_package "ipw2100-fw") ipw2100"
                echo " 2) $(checkbox_package "ipw2200-fw") ipw2200"
                echo " 3) $(checkbox_package "b43-firmware") b43"
                echo " 4) $(checkbox_package "b43-firmware-legacy") b43legacy"
                echo " 5) $(checkbox_package "broadcom-wl") broadcom-wl"
                echo " 6) $(checkbox_package "bluez-firmware") bluez-firmware"
                echo ""
                echo " d) DONE"
                echo ""
                FIRMWARE_OPTIONS+=" d"
                read_input_options "FIRMWARE_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            package_install "ipw2100-fw"
                            ;;
                        2)
                            package_install "ipw2200-fw"
                            ;;
                        3)
                            aur_package_install "b43-firmware"
                            ;;
                        4)
                            aur_package_install "b43-firmware-legacy"
                            ;;
                        5)
                            aur_package_install "broadcom-wl"
                            ;;
                        6)
                            package_install "bluez-firmware"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            CURRENT_STATUS=1
            ;;
            #}}}
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Additional Firmware"
    pause_function
}
#}}}
#GIT ACCESS THRU A FIREWALL {{{
function install_git_tor(){
    print_title "GIT-TOR - https://wiki.archlinux.org/index.php/Tor"
    read_input_text "Ensuring access to GIT through a firewall (bypass college/work firewall)" $GITTOR
    case "$OPTION" in
        "y")
            package_install "openbsd-netcat vidalia privoxy git"
            if [[ ! -f /usr/bin/proxy-wrapper ]]; then
                echo 'forward-socks5   /               127.0.0.1:9050 .' >> /etc/privoxy/config
                echo -e '#!/bin/bash\nnc.openbsd -xlocalhost:9050 -X5 $*' > /usr/bin/proxy-wrapper
                chmod +x /usr/bin/proxy-wrapper
                echo -e '\nexport GIT_PROXY_COMMAND="/usr/bin/proxy-wrapper"' >> /etc/bash.bashrc
                export GIT_PROXY_COMMAND="/usr/bin/proxy-wrapper"
                su -l $USERNAME --command="export GIT_PROXY_COMMAND=\"/usr/bin/proxy-wrapper\""
            fi
            groupadd -g 42 privoxy
            useradd -u 42 -g privoxy -s /bin/false -d /etc/privoxy privoxy
            pacman -S --noconfirm tor privoxy
            add_daemon "@tor @privoxy"
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "GIT-TOR installation"
    pause_function
}
#}}}
#DESKTOP ENVIRONMENT {{{
function install_desktop_environment(){
    function install_icons() { #{{{
        while [[ 1 ]]
        do
            print_title "GNOME ICONS"
            echo " 1) $(checkbox_package "awoken-icons") Awoken"
            echo " 2) $(checkbox_package "faenza-icon-theme") Faenza"
            echo " 3) $(checkbox_package "faenza-cupertino-icon-theme") Faenza-Cupertino"
            echo " 4) $(checkbox_package "faience-icon-theme") Faience"
            echo " 5) $(checkbox_package "elementary-icons") Elementary"
            echo ""
            echo " b) BACK"
            echo ""
            GNOME_ICONS+=" b"
            read_input_options "$GNOME_ICONS"
            for OPT in ${OPTIONS[@]}; do
                case "$OPT" in
                    1)
                        aur_package_install "awoken-icons"
                        ;;
                    2)
                        aur_package_install "faenza-icon-theme"
                        ;;
                    3)
                        aur_package_install "faenza-cupertino-icon-theme"
                        ;;
                    4)
                        aur_package_install "faience-icon-theme"
                        ;;
                    5)
                        aur_package_install "elementary-icons"
                        ;;
                    "b")
                        break
                        ;;
                    *)
                        invalid_option
                        ;;
                esac
            done
        elihw
        done
    } #}}}
    print_title "DESKTOP ENVIRONMENT - https://wiki.archlinux.org/index.php/Desktop_Environment"
    echo "Choose your desktop-environment:"
    echo " 1) GNOME"
    echo " 2) KDE"
    echo " 3) XFCE"
    echo " 4) LXDE"
    echo " 5) OpenBox"
    echo " 6) Cinnamon"
    echo ""
    echo " b) BACK"
    read_input $DESKTOPENV
    case "$OPTION" in
        1)
            #GNOME {{{
            print_title "GNOME - https://wiki.archlinux.org/index.php/GNOME"
            package_install "gnome gnome-extra zeitgeist telepathy"
            gpasswd -a $USERNAME camera
            package_install "gksu nautilus-open-terminal deja-dup gedit-plugins gnome-tweak-tool"
            package_install "gvfs-smb"
            package_install "pulseaudio"
            package_install "system-config-printer-gnome"
            aur_package_install "empathy-theme-ubuntu-adium-bzr"
            aur_package_install "automounter"
            aur_package_install "gnome-defaults-list"
            echo -e 'exec ck-launch-session gnome-session' >> /home/$USERNAME/.xinitrc
            #GNOME CUSTOMIZATION {{{
            while [[ 1 ]]
            do
                print_title "GNOME CUSTOMIZATION"
                echo " 1) $(checkbox_package "awoken-icons faenza-icon-theme faenza-cupertino-icon-theme faience-icon-theme elementary-icons") Gnome Icons (aur)"
                echo " 2) $(checkbox_package "gtk-theme-boomerang egtk-bzr light-themes orion-gtk-theme zukitwo-themes zukini-theme") Gnome Themes (aur)"
                echo " 3) $(checkbox_package "gpaste-git gnome-shell-extension-gtile-git gnome-shell-extension-mediaplayer-git gnome-shell-extension-noa11y-git gnome-shell-extension-pomodoro-git gnome-shell-extension-user-theme-git gnome-shell-extension-weather-git gnome-shell-system-monitor-applet-git") GnomeShell Extensions (aur)"
                echo " 4) $(checkbox_package "gnome-shell-theme-frieze gnome-shell-theme-elegance") GnomeShell Themes (aur)"
                echo " 5) $(checkbox_package "gnome-activity-journal") Gnome Activity Journal (aur) "
                echo " 6) $(checkbox_package "gloobus-sushi-bzr") Gloobus Preview (aur)"
                echo " 7) $(checkbox_package "gnome-packagekit") Packagekit"
                echo ""
                echo " d) DONE"
                echo ""
                GNOME_OPTIONS+=" d"
                read_input_options "$GNOME_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            install_icons
                            OPT=1
                            ;;
                        2)
                            #THEMES {{{
                            while [[ 1 ]]
                            do
                                print_title "GNOME THEMES"
                                echo " 1) $(checkbox_package "gtk-theme-boomerang") Boomerang"
                                echo " 2) $(checkbox_package "egtk-bzr") eGTK"
                                echo " 3) $(checkbox_package "light-themes") Light (aka Ambiance/Radiance)"
                                echo " 4) $(checkbox_package "orion-gtk-theme") Orion"
                                echo " 5) $(checkbox_package "zukini-theme") Zukini"
                                echo " 6) $(checkbox_package "zukitwo-themes") Zukitwo"
                                echo ""
                                echo " b) BACK"
                                echo ""
                                GNOME_THEMES+=" b"
                                read_input_options "$GNOME_THEMES"
                                for OPT in ${OPTIONS[@]}; do
                                    case "$OPT" in
                                        1)
                                            aur_package_install "gtk-theme-boomerang"
                                            ;;
                                        2)
                                            aur_package_install "egtk-bzr"
                                            ;;
                                        3)
                                            aur_package_install "light-themes"
                                            ;;
                                        4)
                                            aur_package_install "orion-gtk-theme"
                                            ;;
                                        5)
                                            aur_package_install "zukini-theme"
                                            ;;
                                        6)
                                            aur_package_install "zukitwo-themes"
                                            ;;
                                        "b")
                                            break
                                            ;;
                                        *)
                                            invalid_option
                                            ;;
                                    esac
                                done
                            elihw
                            done
                            #}}}
                            OPT=2
                            ;;
                        3)
                            #GNOMESHELL EXTENSIONS {{{
                            while [[ 1 ]]
                            do
                                print_title "GNOMESHELL EXTENSIONS"
                                echo " 1) $(checkbox_package "gpaste-git") gpaste"
                                echo " 2) $(checkbox_package "gnome-shell-extension-mediaplayer-git") media-player"
                                echo " 3) $(checkbox_package "gnome-shell-extension-noa11y-git") noa11y"
                                echo " 4) $(checkbox_package "gnome-shell-extension-pomodoro-git") pomodoro"
                                echo " 5) $(checkbox_package "gnome-shell-system-monitor-applet-git") system-monitor"
                                echo " 6) $(checkbox_package "gnome-shell-extension-user-theme-git") user-theme"
                                echo " 7) $(checkbox_package "gnome-shell-extension-weather-git") weather"
                                echo " 8) $(checkbox_package "gnome-shell-extension-gtile-git") gtile"
                                echo ""
                                echo " b) BACK"
                                echo ""
                                GNOME_EXTENSIONS+=" b"
                                read_input_options "$GNOME_EXTENSIONS"
                                for OPT in ${OPTIONS[@]}; do
                                    case "$OPT" in
                                        1)
                                            aur_package_install "gpaste-git"
                                            ;;
                                        2)
                                            aur_package_install "gnome-shell-extension-mediaplayer-git"
                                            ;;
                                        3)
                                            aur_package_install "gnome-shell-extension-noa11y-git"
                                            ;;
                                        4)
                                            aur_package_install "libkeybinder3"
                                            aur_package_install "gnome-shell-extension-pomodoro-git"
                                            ;;
                                        5)
                                            aur_package_install "gnome-shell-system-monitor-applet-git"
                                            ;;
                                        6)
                                            aur_package_install "gnome-shell-extension-user-theme-git"
                                            ;;
                                        7)
                                            aur_package_install "gnome-shell-extension-weather-git"
                                            ;;
                                        8)
                                            aur_package_install "gnome-shell-extension-gtile-git"
                                            ;;
                                        "b")
                                            break
                                            ;;
                                        *)
                                            invalid_option
                                            ;;
                                    esac
                                done
                            elihw
                            done
                            #}}}
                            OPT=3
                            ;;
                        4)
                            #GNOMESHELL THEMES {{{
                            while [[ 1 ]]
                            do
                                print_title "GNOMESHELL THEMES"
                                echo " 1) $(checkbox_package "gnome-shell-theme-elegance") Elegance"
                                echo " 2) $(checkbox_package "gnome-shell-theme-frieze") Frieze"
                                echo ""
                                echo " b) BACK"
                                echo ""
                                GNOME_SHELL_THEMES+=" b"
                                read_input_options "$GNOME_SHELL_THEMES"
                                for OPT in ${OPTIONS[@]}; do
                                    case "$OPT" in
                                        1)
                                            aur_package_install "gnome-shell-theme-elegance"
                                            ;;
                                        2)
                                            aur_package_install "gnome-shell-theme-frieze"
                                            ;;
                                        "b")
                                            break
                                            ;;
                                        *)
                                            invalid_option
                                            ;;
                                    esac
                                done
                            elihw
                            done
                            #}}}
                            OPT=4
                            ;;
                        5)
                            aur_package_install "libzeitgeist python2-rdflib zeitgeist-datahub"
                            aur_package_install "gnome-activity-journal"
                            ;;
                        6)
                            aur_package_install "gloobus-sushi-bzr"
                            ;;
                        7)
                            package_install "gnome-packagekit gnome-settings-daemon-updates"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            config_dm "gdm"
            CURRENT_STATUS=1
            GNOME=1
            ;;
            #}}}
        2)
            #KDE {{{
            print_title "KDE - https://wiki.archlinux.org/index.php/KDE"
            package_install "kde kde-l10n-$LANGUAGE_KDE kipi-plugins"
            package_install "kdeadmin-system-config-printer-kde xdg-user-dirs"
            package_remove "kdemultimedia-kscd kdemultimedia-juk kdemultimedia-dragonplayer"
            aur_package_install "kde-gtk-config-git"
            aur_package_install "oxygen-gtk2 oxygen-gtk3 qtcurve-gtk2 qtcurve-kde4 bespin-svn"
            echo -e 'exec ck-launch-session startkde' >> /home/$USERNAME/.xinitrc
            #QTCURVE THEMES #{{{
            wget http://kde-look.org/CONTENT/content-files/144205-Sweet.tar.gz
            wget http://kde-look.org/CONTENT/content-files/141920-Kawai.tar.gz
            tar zxvf 144205-Sweet.tar.gz
            tar zxvf 141920-Kawai.tar.gz
            rm 144205-Sweet.tar.gz
            rm 141920-Kawai.tar.gz
            mkdir -p /home/$USERNAME/.kde4/share/apps/color-schemes
            mv Sweet/Sweet.colors /home/$USERNAME/.kde4/share/apps/color-schemes
            mv Kawai/Kawai.colors /home/$USERNAME/.kde4/share/apps/color-schemes
            mkdir -p /home/$USERNAME/.kde4/share/apps/QtCurve
            mv Sweet/Sweet.qtcurve /home/$USERNAME/.kde4/share/apps/QtCurve
            mv Kawai/Kawai.qtcurve /home/$USERNAME/.kde4/share/apps/QtCurve
            chown -R $USERNAME:users /home/$USERNAME/.kde4
            rm -fr Kawai Sweet
            #}}}
            #KDE CUSTOMIZATION {{{
            while [[ 1 ]]
            do
                print_title "KDE CUSTOMIZATION"
                echo " 1) $(checkbox_package "apper") Apper"
                echo " 2) $(checkbox_package "bangarang") Bangarang (aur)"
                echo " 3) $(checkbox_package "choqok") Choqok"
                echo " 4) $(checkbox_package "digikam") Digikam"
                echo " 5) $(checkbox_package "k3b") K3b"
                echo " 6) $(checkbox_package "rosa-icons kfaenza-icon-theme") KDE Icons (aur)"
                echo " 7) $(checkbox_package "caledonia-bundle plasma-theme-produkt") Plasma Themes (aur)"
                echo " 8) $(checkbox_package "yakuake") Yakuake"
                echo ""
                echo " d) DONE"
                echo ""
                KDE_OPTIONS+=" d"
                read_input_options "$KDE_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            package_install "apper"
                            ;;
                        2)
                            aur_package_install "bangarang"
                            ;;
                        3)
                            package_install "choqok"
                            ;;
                        4)
                            package_install "digikam"
                            ;;
                        5)
                            package_install "k3b dvd+rw-tools"
                            ;;
                        6)
                            aur_package_install "rosa-icons kfaenza-icon-theme"
                            ;;
                        7)
                            aur_package_install "caledonia-bundle plasma-theme-rosa plasma-theme-produkt ronak-plasmatheme"
                            ;;
                        8)
                            package_install "yakuake"
                            aur_package_install "yakuake-skin-plasma-oxygen-panel"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            config_dm "kdm"
            CURRENT_STATUS=1
            KDE=1
            ;;
            #}}}
        3)
            #XFCE {{{
            print_title "XFCE - https://wiki.archlinux.org/index.php/Xfce"
            package_install "xfce4 xfce4-goodies"
            package_install "polkit-gnome gvfs-smb xdg-user-dirs"
            aur_package_install "automounter"
            aur_package_install "gnome-defaults-list"
            echo -e 'exec ck-launch-session startxfce4' >> /home/$USERNAME/.xinitrc
            #XFCE CUSTOMIZATION{{{
            while [[ 1 ]]
            do
                print_title "XFCE CUSTOMIZATION"
                echo " 1) $(checkbox_package "awoken-icons faenza-icon-theme faenza-cupertino-icon-theme faience-icon-theme elementary-icons") Icons (aur)"
                echo " 2) $(checkbox_package "xfce-theme-greybird xfce-theme-bluebird zukitwo-themes") XFCE Themes (aur)"
                echo " 3) $(checkbox_package "slim") Slim"
                echo ""
                echo " d) DONE"
                echo ""
                XFCE_OPTIONS+=" d"
                read_input_options "$XFCE_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            install_icons
                            OPT=1
                            ;;
                        2)
                            #THEMES {{{
                            while [[ 1 ]]
                            do
                                print_title "XFCE THEMES"
                                echo " 1) $(checkbox_package "xfce-theme-bluebird") Bluebird"
                                echo " 2) $(checkbox_package "xfce-theme-greybird") Greybird)"
                                echo " 3) $(checkbox_package "zukitwo-themes") Zukitwo"
                                echo ""
                                echo " b) BACK"
                                echo ""
                                XFCE_THEMES+=" b"
                                read_input_options "$XFCE_THEMES"
                                for OPT in ${OPTIONS[@]}; do
                                    case "$OPT" in
                                        1)
                                            aur_package_install "xfce-theme-bluebird"
                                            ;;
                                        2)
                                            aur_package_install "xfce-theme-greybird"
                                            ;;
                                        3)
                                            aur_package_install "zukitwo-themes"
                                            ;;
                                        "b")
                                            break
                                            ;;
                                        *)
                                            invalid_option
                                            ;;
                                    esac
                                done
                            elihw
                            done
                            #}}}
                            OPT=2
                            ;;
                        3)
                            package_install "slim"
                            config_dm "slim"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            CURRENT_STATUS=1
            XFCE=1
            ;;
            #}}}
        4)
            #LXDE {{{
            print_title "LXDE - http://wiki.archlinux.org/index.php/lxde"
            package_install "lxde obconf"
            package_install "leafpad xarchiver epdfview"
            package_install "pm-utils upower"
            package_install "polkit-gnome gvfs gvfs-smb xdg-user-dirs"
            aur_package_install "gnome-defaults-list"
            echo -e 'exec ck-launch-session startlxde' >> /home/$USERNAME/.xinitrc
            #LXDE CUSTOMIZATION{{{
            while [[ 1 ]]
            do
                print_title "LXDE CUSTOMIZATION"
                echo " 1) $(checkbox_package "awoken-icons faenza-icon-theme faenza-cupertino-icon-theme faience-icon-theme elementary-icons") Icons (aur)"
                echo " 2) $(checkbox_package "lxdm") LXDM (aur)"
                echo " 3) $(checkbox_package "xfburn") Xfburn"
                echo ""
                echo " d) DONE"
                echo ""
                LXDE_OPTIONS+=" d"
                read_input_options "$LXDE_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            install_icons
                            OPT=1
                            ;;
                        2)
                            aur_package_install "lxdm"
                            local lxdm=`cat /etc/inittab | sed -n '/lxdm/p'`
                            if [[ -z "$lxdm" ]]; then
                                echo -e "x:5:respawn:/usr/sbin/lxdm >& /dev/null" >> /etc/inittab
                            fi
                            config_dm "lxdm"
                            ;;
                        3)
                            package_install "xfburn"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            CURRENT_STATUS=1
            LXDE=1
            ;;
            #}}}
        5)
            #OPENBOX {{{
            print_title "OPENBOX - http://wiki.archlinux.org/index.php/Openbox"
            package_install "openbox obconf obmenu menumaker"
            package_install "lxappearance consolekit"
            package_install "xdg-user-dirs"
            package_install "leafpad xarchiver epdfview nitrogen"
            aur_package_install "gnome-defaults-list"
            mkdir -p /home/$USERNAME/.config/openbox/
            cp /etc/xdg/openbox/rc.xml /home/$USERNAME/.config/openbox/
            cp /etc/xdg/openbox/menu.xml /home/$USERNAME/.config/openbox/
            cp /etc/xdg/openbox/autostart /home/$USERNAME/.config/openbox/
            chown -R $USERNAME:users /home/$USERNAME/.config
            echo -e 'exec ck-launch-session openbox-session' >> /home/$USERNAME/.xinitrc
            #OPENBOX CUSTOMIZATION {{{
            while [[ 1 ]]
            do
                print_title "OPENBOX CUSTOMIZATION"
                echo " 1) $(checkbox_package "compton-git") Compton (aur) [xcompmgr fork]"
                echo " 2) $(checkbox_package "awoken-icons faenza-icon-theme faenza-cupertino-icon-theme faience-icon-theme elementary-icons") Icons (aur)"
                echo " 3) $(checkbox_package "geeqie") Geeqie"
                echo " 4) $(checkbox_package "gmrun") Gmrun"
                echo " 5) $(checkbox_package "rxvt-unicode") rxvt-unicode"
                echo " 6) $(checkbox_package "scrot") Scrot"
                echo " 7) $(checkbox_package "slim") Slim"
                echo " 8) $(checkbox_package "thunar") Thunar"
                echo " 9) $(checkbox_package "tint2") Tint2"
                echo "10) $(checkbox_package "volwheel") Volwheel"
                echo "11) $(checkbox_package "xfburn") Xfburn"
                echo ""
                echo " d) DONE"
                echo ""
                OPENBOX_OPTIONS+=" d"
                read_input_options "$OPENBOX_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            aur_package_install "compton-git"
                            ;;
                        2)
                            install_icons
                            OPT=2
                            ;;
                        3)
                            package_install "geeqie"
                            ;;
                        4)
                            package_install "gmrun"
                            ;;
                        5)
                            package_install "rxvt-unicode"
                            ;;
                        6)
                            package_install "scrot"
                            ;;
                        7)
                            package_install "slim"
                            config_dm "slim"
                            ;;
                        8)
                            package_install "polkit-gnome gvfs-smb thunar"
                            ;;
                        9)
                            package_install "tint2"
                            ;;
                        10)
                            package_install "volwheel"
                            ;;
                        11)
                            package_install "xfburn"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            CURRENT_STATUS=1
            OPENBOX=1
            ;;
            #}}}
        6)
            #CINNAMON {{{
            print_title "CINNAMON - https://wiki.archlinux.org/index.php/Cinnamon"
            aur_package_install "cinnamon cinnamon-themes cinnamon-applets"
            package_install "gnome-extra gedit-plugins"
            package_install "telepathy"
            package_install "gksu nautilus-open-terminal xdg-user-dirs-gtk"
            package_install "gvfs-smb"
            package_install "pulseaudio"
            package_install "deja-dup"
            package_install "system-config-printer-gnome"
            aur_package_install "empathy-theme-ubuntu-adium-bzr"
            aur_package_install "automounter gnome-defaults-list"
            gpasswd -a $USERNAME camera
            echo -e 'exec ck-launch-session gnome-session-cinnamon' >> /home/$USERNAME/.xinitrc
            #CINNAMON CUSTOMIZATION {{{
            while [[ 1 ]]
            do
                print_title "CINNAMON CUSTOMIZATION"
                echo " 1) $(checkbox_package "awoken-icons faenza-icon-theme faenza-cupertino-icon-theme faience-icon-theme elementary-icons")* Gnome Icons [Faience, Faenza, Elementary]"
                echo " 2) $(checkbox_package "zukini-theme gtk-theme-boomerang egtk-bzr light-themes orion-gtk-theme zukitwo-themes")* Gnome Themes [Orion, eGTK, Light, Zukitwo, Zukini]"
                echo " 3) $(checkbox_package "gnome-activity-journal")* Gnome Activity Journal "
                echo " 4) $(checkbox_package "gloobus-sushi-bzr")* Gloobus Preview"
                echo " 5) $(checkbox_package "gnome-packagekit") Packagekit"
                echo ""
                echo " d) DONE"
                echo ""
                GNOME_OPTIONS+=" d"
                read_input_options "$GNOME_OPTIONS"
                for OPT in ${OPTIONS[@]}; do
                    case "$OPT" in
                        1)
                            install_icons
                            OPT=1
                            ;;
                        2)
                            #THEMES {{{
                            while [[ 1 ]]
                            do
                                print_title "GNOME THEMES"
                                echo " 1) $(checkbox_package "gtk-theme-boomerang") Boomerang"
                                echo " 2) $(checkbox_package "egtk-bzr") eGTK"
                                echo " 3) $(checkbox_package "light-themes") Light (aka Ambiance/Radiance)"
                                echo " 4) $(checkbox_package "orion-gtk-theme") Orion"
                                echo " 5) $(checkbox_package "zukini-theme") Zukini"
                                echo " 6) $(checkbox_package "zukitwo-themes") Zukitwo"
                                echo ""
                                echo " b) BACK"
                                echo ""
                                GNOME_THEMES+=" b"
                                read_input_options "$GNOME_THEMES"
                                for OPT in ${OPTIONS[@]}; do
                                    case "$OPT" in
                                        1)
                                            aur_package_install "gtk-theme-boomerang"
                                            ;;
                                        2)
                                            aur_package_install "egtk-bzr"
                                            ;;
                                        3)
                                            aur_package_install "light-themes"
                                            ;;
                                        4)
                                            aur_package_install "orion-gtk-theme"
                                            ;;
                                        5)
                                            aur_package_install "zukini-theme"
                                            ;;
                                        6)
                                            aur_package_install "zukitwo-themes"
                                            ;;
                                        "b")
                                            break
                                            ;;
                                        *)
                                            invalid_option
                                            ;;
                                    esac
                                done
                            elihw
                            done
                            #}}}
                            OPT=2
                            ;;
                        3)
                            aur_package_install "zeitgeist libzeitgeist python2-rdflib zeitgeist-datahub"
                            aur_package_install "gnome-activity-journal"
                            ;;
                        4)
                            aur_package_install "gloobus-sushi-bzr"
                            ;;
                        5)
                            package_install "gnome-packagekit gnome-settings-daemon-updates"
                            ;;
                        "d")
                            break
                            ;;
                        *)
                            invalid_option
                            ;;
                    esac
                done
            elihw
            done
            #}}}
            config_dm "gdm"
            CURRENT_STATUS=1
            GNOME=1
            ;;
            #}}}
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Desktop Environment Installation"
    pause_function
}
#}}}
#NETWORKMANAGER/WICD {{{
function install_nm_wicd(){
    print_title "NETWORK CONNECTION MANAGER"
    echo " 1) Networkmanager"
    echo " 2) Wicd"
    echo ""
    echo " n) NONE"
    echo ""
    read_input $NETWORKMANAGER
    case "$OPTION" in
        1)
            print_title "NETWORKMANAGER - https://wiki.archlinux.org/index.php/Networkmanager"
            if [[ $GNOME -eq 1 || $XFCE -eq 1 || $LXDE -eq 1 ]]; then
                package_install "networkmanager network-manager-applet"
            elif [[ $KDE -eq 1 ]]; then
                package_install "networkmanager kdeplasma-applets-networkmanagement"
            else
                package_install "networkmanager"
            fi
            groupadd networkmanager
            gpasswd -a $USERNAME networkmanager
            remove_daemon "networkmanager"
            remove_daemon "network"
            remove_daemon "wicd"
            add_daemon "networkmanager"
            CURRENT_STATUS=1
            sumary "Networkmanager installation"
            ;;
        2)
            print_title "WICD - https://wiki.archlinux.org/index.php/Wicd"
            if [[ $GNOME -eq 1 || $XFCE -eq 1 || $LXDE -eq 1 ]]; then
                package_install "wicd wicd-gtk"
            elif [[ $KDE -eq 1 ]]; then
                aur_package_install "wicd wicd-kde"
            else
                package_install "wicd"
            fi
            remove_daemon "networkmanager"
            remove_daemon "network"
            add_daemon "wicd"
            CURRENT_STATUS=1
            sumary "Wicd installation"
            ;;
        *)
            remove_daemon "networkmanager"
            remove_daemon "wicd"
            add_daemon "network"
            CURRENT_STATUS=0
            sumary "Network manager installation"
            ;;
    esac
    if check_package "nfs-utils" ; then
        add_daemon "rpcbind"
        add_daemon "nfs-common"
        add_daemon "nfs-server"
    fi
    pause_function
}
#}}}
#ACCESSORIES {{{
function install_accessories_apps(){
while [[ 1 ]]
do
    print_title "ACCESSORIES APPS"
    echo " 1) $(checkbox_package "cairo-dock-bzr") Cairo Dock (aur)"
    echo " 2) $(checkbox_package "conky-lua") Conky + CONKY-colors (aur)"
    echo " 3) $(checkbox_package "deepin-scrot-git") Deepin Scrot (aur)"
    echo " 4) $(checkbox_package "dockbarx") Dockbarx (aur)"
    echo " 5) $(checkbox_package "docky") Docky (aur)"
    echo " 6) $(checkbox_package "speedcrunch galculator") $(if [[ $KDE -eq 1 ]]; then echo "Speedcrunch"; else echo "Galculator"; fi) (aur)"
    echo " 7) $(checkbox_package "gnome-pie") Gnome-Pie (aur)"
    echo " 8) $(checkbox_package "guake") Guake"
    echo " 9) $(checkbox_package "kupfer") Kupfer (aur)"
    echo "10) $(checkbox_package "pyrenamer") Pyrenamer (aur)"
    echo "11) $(checkbox_package "shutter") Shutter (aur)"
    echo "12) $(checkbox_package "synapse") Synapse (aur)"
    echo "13) $(checkbox_package "terminator") Terminator"
    echo "14) $(checkbox_package "zim") Zim"
    echo ""
    echo " b) BACK"
    echo ""
    ACCESSORIES_OPTIONS+=" b"
    read_input_options "$ACCESSORIES_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                aur_package_install "cairo-dock-bzr cairo-dock-plugins-bzr"
                ;;
            2)
                aur_package_install "conky-lua conky-colors"
                sensors-detect
                add_daemon "sensors"
                ;;
            3)
                aur_package_install "deepin-scrot-git"
                ;;
            4)
                aur_package_install "dockbarx dockbarx-shinybar-theme"
                ;;
            5)
                aur_package_install "docky"
                ;;
            6)
                if [[ $KDE -eq 1 ]]; then
                    aur_package_install "speedcrunch"
                else
                    aur_package_install "galculator"
                fi
                ;;
            7)
                aur_package_install "gnome-pie"
                ;;
            8)
                package_install "guake"
                ;;
            9)
                aur_package_install "kupfer"
                ;;
            10)
                aur_package_install "pyrenamer"
                ;;
            11)
                aur_package_install "shutter"
                ;;
            12)
                package_install "zeitgeist"
                aur_package_install "libzeitgeist zeitgeist-datahub"
                aur_package_install "synapse"
                ;;
            13)
                package_install "terminator"
                aur_package_install "python-keybinder"
                ;;
            14)
                package_install "zim"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#DEVELOPEMENT {{{
function install_development_apps(){
while [[ 1 ]]
do
    print_title "DEVELOPMENT APPS"
    echo " 1) $(checkbox_package "aptana-studio") Aptana Studio (aur)"
    echo " 2) $(checkbox_package "bluefish") Bluefish"
    echo " 3) $(checkbox_package "eclipse") Eclipse"
    echo " 4) $(checkbox_package "emacs") Emacs"
    echo " 5) $(checkbox_package "gvim") Gvim"
    echo " 6) $(checkbox_package "geany") Geany"
    echo " 7) $(checkbox_package "intellij-idea-community-edition") IntelliJ IDEA"
    echo " 8) $(checkbox_package "netbeans") Netbeans"
    echo " 9) $(checkbox_package "jdk") Oracle Java (aur)"
    echo "10) $(checkbox_package "qtcreator") QT Creator"
    echo "11) $(checkbox_package "sublime-text") Sublime Text 2 (aur)"
    echo "12) $(checkbox_package "gdb") Debugger Tools [Valgrind, Gdb, Splint, Tidyhtml, Pyflakes, Jslint]"
    echo "13) $(checkbox_package "mysql-workbench") MySQL Workbench (aur)"
    echo "14) $(checkbox_package "meld") Meld"
    echo "15) $(checkbox_package "rabbitvcs") RabbitVCS (aur)"
    echo ""
    echo " b) BACK"
    echo ""
    DEVELOPMENT_OPTIONS+=" b"
    read_input_options "$DEVELOPMENT_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                aur_package_install "aptana-studio"
                ;;
            2)
                package_install "bluefish"
                ;;
            3)
                #ECLIPSE {{{
                while [[ 1 ]]
                do
                    print_title "ECLIPSE - https://wiki.archlinux.org/index.php/Eclipse"
                    echo " 1) $(checkbox_package "eclipse") Eclipse Classic"
                    echo " 2) $(checkbox_package "eclipse-cdt") Eclipse IDE for C/C++ Developers "
                    echo " 3) $(checkbox_package "eclipse-android") Android Development Tools for Eclipse"
                    echo " 4) $(checkbox_package "eclipse-wtp-wst") Web Development Tools for Eclipse"
                    echo " 5) $(checkbox_package "eclipse-pdt") PHP Development Tools for Eclipse"
                    echo " 6) $(checkbox_package "eclipse-pydev") Python Development Tools for Eclipse"
                    echo " 7) $(checkbox_package "eclipse-aptana") Aptana Studio plugin for Eclipse"
                    echo " 8) $(checkbox_package "eclipse-vrapper") Vim-like editing plugin for Eclipse"
                    echo " 9) $(checkbox_package "eclipse-egit") Git support plugin for Eclipse"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    ECLIPSE_OPTIONS+=" b"
                    read_input_options "$ECLIPSE"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "eclipse"
                                ;;
                            2)
                                aur_package_install "eclipse-cdt"
                                ;;
                            3)
                                aur_package_install "eclipse-android android-apktool android-sdk android-sdk-platform-tools android-udev"
                                ;;
                            4)
                                aur_package_install "eclipse-wtp-wst"
                                ;;
                            5)
                                aur_package_install "eclipse-pdt"
                                ;;
                            6)
                                aur_package_install "eclipse-pydev"
                                ;;
                            7)
                                aur_package_install "eclipse-aptana"
                                ;;
                            8)
                                aur_package_install "eclipse-vrapper"
                                ;;
                            9)
                                aur_package_install "eclipse-egit"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=3
                ;;
            4)
                package_install "emacs"
                ;;
            5)
                package_remove "vim"
                package_install "gvim"
                ;;
            6)
                package_install "geany"
                ;;
            7)
                package_install "intellij-idea-community-edition"
                ;;
            8)
                package_install "netbeans"
                ;;
            9)
                pacman -Rdd --noconfirm jre7-openjdk
                pacman -Rdd --noconfirm jdk7-openjdk
                aur_package_install "jdk"
                ;;
            10)
                package_install "qtcreator qt-doc"
                mkdir -p /home/$USERNAME/.config/Nokia/qtcreator/styles
                wget http://angrycoding.googlecode.com/svn/branches/qt-creator-monokai-theme/monokai.xml
                mv monokai.xml /home/$USERNAME/.config/Nokia/qtcreator/styles/
                chown -R $USERNAME:users /home/$USERNAME/.config
                ;;
            11)
                aur_package_install "sublime-text"
                ;;
            12)
                aur_package_install "valgrind gdb splint tidyhtml python2-pyflakes jslint"
                ;;
            13)
                aur_package_install "mysql-workbench"
                ;;
            14)
                package_install "meld"
                ;;
            15)
                aur_package_install "rabbitvcs"
                if [[ $GNOME -eq 1 ]]; then
                    aur_package_install "rabbitvcs-nautilus"
                elif [[ $XFCE -eq 1 ]]; then
                    aur_package_install "rabbitvcs-thunar"
                else
                    aur_package_install "rabbitvcs-cli"
                fi
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#OFFICE {{{
function install_office_apps(){
while [[ 1 ]]
do
    print_title "OFFICE APPS"
    echo " 1) $(checkbox_package "libreoffice-common") LibreOffice"
    echo " 2) $(checkbox_package "goffice") GnomeOffice [Abiword, Gnumeric]"
    echo " 3) $(checkbox_package "texlive-core") Latex + Texmaker"
    echo " 4) $(if [[ $KDE -eq 1 ]]; then  echo "$(checkbox_package "kchmviewer") Kchmviewer"; else echo "$(checkbox_package "chmsee") Chmsee"; fi)"
    echo " 5) $(checkbox_package "gcstar") GCStar"
    echo " 6) $(checkbox_package "impressive") Impressive"
    echo " 7) $(checkbox_package "nitrotasks") Nitrotasks (aur)"
    echo " 8) $(checkbox_package "ocrfeeder") OCRFeeder"
    echo " 9) $(checkbox_package "xmind") Xmind (aur)"
    echo "10) $(checkbox_package "zathura") Zathura"
    echo ""
    echo " b) BACK"
    echo ""
    OFFICE_OPTIONS+=" b"
    read_input_options "$OFFICE_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                print_title "LIBREOFFICE - https://wiki.archlinux.org/index.php/LibreOffice"
                package_install "libreoffice-$LANGUAGE_LO libreoffice-common libreoffice-{base,calc,draw,impress,math,writer} libreoffice-extension-presenter-screen libreoffice-extension-pdfimport"
                aur_package_install "hunspell-$LANGUAGE_HS"
                aur_package_install "aspell-$LANGUAGE_AS"
                if [[ $KDE -eq 1 ]]; then
                    package_install "libreoffice-kde4"
                else
                    package_install "libreoffice-gnome"
                fi
                ;;
            2)
                package_install "gnumeric abiword abiword-plugins"
                aur_package_install "hunspell-$LANGUAGE_HS"
                aur_package_install "aspell-$LANGUAGE_AS"
                ;;
            3)
                print_title "LATEX - https://wiki.archlinux.org/index.php/LaTeX"
                package_install "texlive-most"
                aur_package_install "texmaker"
                if [[ $LANGUAGE == pt_BR ]]; then
                    aur_package_install "abntex"
                fi
                ;;
            4)
                if [[ $KDE -eq 1 ]]; then
                    package_install "kchmviewer"
                else
                    package_install "chmsee"
                fi
                ;;
            5)
                package_install "gcstar"
                ;;
            6)
                package_install "impressive"
                ;;
            7)
                aur_package_install "nitrotasks"
                ;;
            8)
                package_install "ocrfeeder tesseract gocr"
                aur_package_install "aspell-$LANGUAGE_AS"
                ;;
            9)
                aur_package_install "xmind"
                ;;
            10)
                package_install "zathura"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#SYSTEM TOOLS {{{
function install_system_apps(){
while [[ 1 ]]
do
    print_title "SYSTEM TOOLS APPS"
    echo " 1) $(checkbox_package "gparted") Gparted"
    echo " 2) $(checkbox_package "grsync") Grsync"
    echo " 3) $(checkbox_package "htop") Htop"
    echo " 4) $(checkbox_package "virtualbox") Virtualbox"
    echo " 5) $(checkbox_package "wine") Wine"
    echo ""
    echo " b) BACK"
    echo ""
    SYSTEMTOOLS_OPTIONS+=" b"
    read_input_options "$SYSTEMTOOLS_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                package_install "gparted"
                ;;
            2)
                package_install "grsync"
                ;;
            3)
                package_install "htop"
                ;;
            4)
                package_install "virtualbox virtualbox-additions"
                aur_package_install "virtualbox-ext-oracle"
                add_module "vboxdrv"
                groupadd vboxusers
                gpasswd -a $USERNAME vboxusers
                ;;
            5)
                package_install "wine wine_gecko winetricks"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#GRAPHICS {{{
function install_graphics_apps(){
while [[ 1 ]]
do
    print_title "GRAPHICS APPS"
    echo " 1) $(checkbox_package "blender") Blender"
    echo " 2) $(checkbox_package "gimp") Gimp"
    echo " 3) $(checkbox_package "gimp-paint-studio") Gimp-plugins (aur)"
    echo " 4) $(checkbox_package "gthumb") Gthumb"
    echo " 5) $(checkbox_package "inkscape") Inkscape"
    echo " 6) $(checkbox_package "mcomix") MComix"
    echo " 7) $(checkbox_package "mypaint") Mypaint"
    echo " 8) $(checkbox_package "shotwell") Shotwell"
    echo ""
    echo " b) BACK"
    echo ""
    GRAPHICS_OPTIONS+=" b"
    read_input_options "$GRAPHICS_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                package_install "blender"
                ;;
            2)
                package_install "gimp"
                ;;
            3)
                aur_package_install "gimp-paint-studio gimp-resynth gimpfx-foundry gimp-plugin-pandora gimp-plugin-saveforweb"
                ;;
            4)
                package_install "gthumb"
                ;;
            5)
                package_install "inkscape uniconvertor python2-numpy python-lxml"
                aur_package_install "sozi"
                ;;
            6)
                aur_package_install "mcomix"
                ;;
            7)
                aur_package_install "mypaint"
                ;;
            8)
                aur_package_install "shotwell"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#INTERNET {{{
function install_internet_apps(){
while [[ 1 ]]
do
    print_title "INTERNET APPS"
    echo " 1) $(checkbox_package "dropbox") Dropbox (aur)"
    echo " 2) $(checkbox_package "chromium") Chromium"
    echo " 3) $(checkbox_package "google-earth") Google Earth (aur)"
    echo " 4) $(checkbox_package "google-chrome") Google Chrome (aur)"
    echo " 5) $(checkbox_package "jdownloader") Jdownloader (aur)"
    echo " 6) $(checkbox_package "irssi") Irssi"
    echo " 7) $(checkbox_package "firefox") Mozilla Firefox"
    echo " 8) $(checkbox_package "thunderbird") Mozilla Thunderbird"
    echo " 9) $(checkbox_package "pidgin") Pidgin"
    echo "10) $(checkbox_package "remmina") Remmina"
    echo "11) $(checkbox_package "skype") Skype"
    echo "12) $(checkbox_package "teamspeak3") Teamspeak (aur)"
    echo "13) $(checkbox_package "teamviewer") Teamviewer (aur)"
    echo "14) $(if [[ $KDE -eq 1 ]]; then echo "$(checkbox_package "transmission-qt")"; else echo "$(checkbox_package "transmission-gtk")"; fi) Trasmission"
    echo "15) $(if [[ $KDE -eq 1 ]]; then echo "$(checkbox_package "konversation") Konversation"; else echo "$(checkbox_package "xchat") X-Chat"; fi)"
    echo ""
    echo " b) BACK"
    echo ""
    INTERNET_OPTIONS+=" b"
    read_input_options "$INTERNET_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                aur_package_install "dropbox"
                if [[ $GNOME -eq 1 ]]; then
                    aur_package_install "nautilus-dropbox"
                elif [[ $XFCE -eq 1 ]]; then
                    aur_package_install "thunar-dropbox"
                elif [[ $KDE -eq 1 ]]; then
                    aur_package_install "kfilebox"
                else
                    aur_package_install "dropbox-cli"
                fi
                ;;
            2)
                package_install "chromium flashplugin"
                ;;
            3)
                aur_package_install "google-earth"
                ;;
            4)
                aur_package_install "google-chrome flashplugin"
                ;;
            5)
                aur_package_install "jdownloader"
                ;;
            6)
                package_install "irssi"
                ;;
            7)
                package_install "firefox firefox-i18n-$LANGUAGE_FF flashplugin "
                ;;
            8)
                package_install "thunderbird thunderbird-i18n-$LANGUAGE_FF"
                ;;
            9)
                package_install "pidgin"
                ;;
            10)
                package_install "remmina"
                ;;
            11)
                package_install "skype"
                ;;
            12)
                aur_package_install "teamspeak3"
                ;;
            13)
                aur_package_install "teamviewer"
                ;;
            14)
                if [[ $KDE -eq 1 ]]; then
                    package_install "transmission-qt"
                else
                    package_install "transmission-gtk"
                fi
                ;;
            15)
                if [[ $KDE -eq 1 ]]; then
                    package_install "konversation"
                else
                    package_install "xchat"
                fi
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#LAMP #{{{
function install_lamp(){
print_title "LAMP SERVER - APACHE, MYSQL & PHP + ADMINER\n# https://wiki.archlinux.org/index.php/LAMP"
read_input_text "Install LAMP" $LAMP
case "$OPTION" in
    "y")
        package_install "apache mysql php php-apache php-mcrypt php-gd"
        aur_package_install "adminer"
        if [[ ! -f /etc/php/php.ini.aui ]]; then
            cp -v /etc/php/php.ini /etc/php/php.ini.aui
            cp -v /etc/httpd/conf/extra/httpd-userdir.conf /etc/httpd/conf/extra/httpd-userdir.conf.aui
            cp -v /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.aui
            add_daemon "httpd @mysqld"
            #CONFIGURE LAMP SERVER {{{
            /usr/bin/mysql_secure_installation
            echo -e '\n# adminer configuration\nInclude conf/extra/httpd-adminer.conf' >> /etc/httpd/conf/httpd.conf
            echo -e 'application/x-httpd-php        php' >> /etc/httpd/conf/mime.types
            sed -i '/LoadModule dir_module modules\/mod_dir.so/a\LoadModule php5_module modules\/libphp5.so' /etc/httpd/conf/httpd.conf
            echo -e '\n# Use for PHP 5.x:\nInclude conf/extra/php5_module.conf\n\nAddHandler php5-script php' >> /etc/httpd/conf/httpd.conf
            sed -i 's/DirectoryIndex\ index.html/DirectoryIndex\ index.html\ index.php/g' /etc/httpd/conf/httpd.conf
            sed -i 's/public_html/Sites/g' /etc/httpd/conf/extra/httpd-userdir.conf
            sed -i '/mysqli.so/s/^;//' /etc/php/php.ini
            sed -i '/mysql.so/s/^;//' /etc/php/php.ini
            sed -i '/mcrypt.so/s/^;//' /etc/php/php.ini
            sed -i '/gd.so/s/^;//' /etc/php/php.ini
            sed -i '/display_errors[=]/s/off/on/' /etc/php/php.ini
            sed -i '/skip-networking/s/^/#/' /etc/mysql/my.cnf
            #}}}
        fi
        su -l $USERNAME --command="mkdir -p ~/Sites"
        su -l $USERNAME --command="chmod o+x ~/ && chmod -R o+x ~/Sites"
        rc.d restart httpd mysqld
        CURRENT_STATUS=1
        print_line
        echo "The folder \"Sites\" has been created in your home"
        echo "You can access your projects at \"http://localhost/~username\""
        ;;
    *)
        CURRENT_STATUS=0
        ;;
esac
sumary "LAMP installation"
pause_function
}
#}}}
#AUDIO {{{
function install_audio_apps(){
while [[ 1 ]]
do
    print_title "AUDIO APPS "
    echo " 1) $(checkbox_package "amarok") Amarok"
    echo " 2) $(checkbox_package "audacious") Audacious"
    echo " 3) $(checkbox_package "banshee") Banshee"
    echo " 4) $(checkbox_package "beatbox-bzr") Beatbox (aur)"
    echo " 5) $(checkbox_package "clementine") Clementine"
    echo " 6) $(checkbox_package "decibel-audio-player2") Decibel (aur)"
    echo " 7) $(checkbox_package "exaile") Exaile (aur)"
    echo " 8) $(checkbox_package "gmusicbrowser-development") Gmusicbrowser (aur)"
    echo " 9) $(checkbox_package "musique") Musique (aur)"
    echo "10) $(checkbox_package "nuvola-bzr-stable") Nuvola (aur)"
    echo "11) $(checkbox_package "rhythmbox") Rhythmbox"
    echo "12) $(checkbox_package "spotify") Spotify (aur)"
    echo "13) $(checkbox_package "soundconverter") Soundconverter"
    echo "14) $(checkbox_package "puddletag") Puddletag (aur)"
    echo "15) $(checkbox_package "audacity") Audacity"
    echo "16) $(checkbox_package "timidity++") MIDI"
    echo "17) $(checkbox_package "gstreamer0.10-ugly") Codecs"
    echo ""
    echo " b) BACK"
    echo ""
    AUDIO_OPTIONS+=" b"
    read_input_options "$AUDIO_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                package_install "amarok"
                ;;
            2)
                package_install "audacious audacious-plugins"
                ;;
            3)
                package_install "banshee"
                ;;
            4)
                aur_package_install "beatbox-bzr"
                ;;
            5)
                package_install "clementine"
                ;;
            6)
                aur_package_install "decibel-audio-player2"
                ;;
            7)
                aur_package_install "exaile"
                ;;
            8)
                aur_package_install "gmusicbrowser-development"
                ;;
            9)
                aur_package_install "musique"
                ;;
            10)
                aur_package_install "nuvola-bzr-stable"
                ;;
            11)
                package_install "rhythmbox"
                ;;
            12)
                aur_package_install "spotify"
                ;;
            13)
                package_install "soundconverter"
                ;;
            14)
                aur_package_install "puddletag"
                ;;
            15)
                package_install "audacity"
                ;;
            16)
                aur_package_install "timidity++ fluidr3"
                echo -e 'soundfont /usr/share/soundfonts/fluidr3/FluidR3GM.SF2' >> /etc/timidity++/timidity.cfg
                ;;
            17)
                package_install "gstreamer0.10-plugins"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#VIDEO {{{
function install_video_apps(){
while [[ 1 ]]
do
    print_title "VIDEO APPS"
    echo " 1) $(checkbox_package "audience-bzr") Audience (aur)"
    echo " 2) $(checkbox_package "gnome-mplayer") Gnome Mplayer"
    echo " 3) $(checkbox_package "parole") Parole"
    echo " 4) $(checkbox_package "minitube") Minitube (aur)"
    echo " 5) $(checkbox_package "miro") Miro"
    echo " 6) $(checkbox_package "rosa-media-player-bin") Rosa Media Player (aur)"
    echo " 7) $(checkbox_package "smplayer") SMplayer"
    echo " 8) $(checkbox_package "vlc") VLC"
    echo " 9) $(checkbox_package "xbmc") XBMC"
    echo "10) $(checkbox_package "arista-transcoder") Arista"
    echo "11) $(checkbox_package "transmageddon") Transmageddon"
    echo "12) $(checkbox_package "kdenlive") Kdenlive"
    echo "13) $(checkbox_package "openshot") Openshot"
    echo "14) $(checkbox_package "pitivi") Pitivi"
    echo "15) $(checkbox_package "kazam-bzr") Kazam (aur)"
    echo "16) $(checkbox_package "codecs codecs64") Codecs (aur)"
    echo ""
    echo " b) BACK"
    echo ""
    VIDEO_OPTIONS+=" b"
    read_input_options "$VIDEO_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                aur_package_install "audience-bzr"
                ;;
            2)
                package_install "gnome-mplayer"
                ;;
            3)
                package_install "parole"
                ;;
            4)
                aur_package_install "minitube"
                ;;
            5)
                package_install "miro"
                ;;
            6)
                aur_package_install "rosa-media-player-bin"
                ;;
            7)
                package_install "smplayer smplayer-themes"
                ;;
            8)
                package_install "vlc"
                if [[ $KDE -eq 1 ]]; then
                    package_install "phonon-vlc"
                fi
                ;;
            9)
                package_install "xbmc"
                ;;
            10)
                package_install "arista-transcoder"
                ;;
            11)
                package_install "transmageddon"
                ;;
            12)
                package_install "kdenlive"
                ;;
            13)
                package_install "openshot"
                ;;
            14)
                package_install "pitivi"
                ;;
            15)
                aur_package_install "python-rsvg"
                aur_package_install "kazam-bzr"
                ;;
            16)
                package_install "libquicktime libdvdread libdvdnav libdvdcss cdrdao"
                if [[ $ARCHI == i686 ]]; then
                    aur_package_install "codecs"
                else
                    aur_package_install "codecs64"
                fi
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#GAMES {{{
function install_games(){
while [[ 1 ]]
do
    print_title "GAMES - https://wiki.archlinux.org/index.php/Games"
    echo " 1) Action/Adventure"
    echo " 2) Arcade/Platformer"
    echo " 3) Dungeon"
    echo " 4) Emulators"
    echo " 5) FPS"
    echo " 6) MMO"
    echo " 7) Puzzle"
    echo " 8) RPG"
    echo " 9) Racing"
    echo "10) Simulation"
    echo "11) Strategy"
    echo ""
    echo " b) BACK"
    echo ""
    FUN+=" b"
    read_input_options "$FUN"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                #ACTION/ADVENTURE {{{
                while [[ 1 ]]
                do
                    print_title "ACTION AND ADVENTURE"
                    echo " 1) $(checkbox_package "astromenace") Astromenace"
                    echo " 2) $(checkbox_package "opentyrian-hg") OpenTyrian (aur)"
                    echo " 3) $(checkbox_package "mars-shooter") M.A.R.S. (aur)"
                    echo " 4) $(checkbox_package "yofrankie") Yo Frankie! (aur)"
                    echo " 5) $(checkbox_package "counter-strike-2d") Counter-Strike 2D (aur)"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    ACTION+=" b"
                    read_input_options "$ACTION"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                package_install "astromenace"
                                ;;
                            2)
                                aur_package_install "opentyrian-hg"
                                ;;
                            3)
                                aur_package_install "mars-shooter"
                                ;;
                            4)
                                aur_package_install "yofrankie"
                                ;;
                            5)
                                aur_package_install "counter-strike-2d"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=1
                ;;
            2)
                #ARCADE/PLATFORMER {{{
                while [[ 1 ]]
                do
                    print_title "ARCADE AND PLATFORMER"
                    echo " 1) $(checkbox_package "opensonic") Opensonic (aur)"
                    echo " 2) $(checkbox_package "frogatto") Frogatto"
                    echo " 3) $(checkbox_package "bomberclone") Bomberclone"
                    echo " 4) $(checkbox_package "goonies") Goonies (aur)"
                    echo " 5) $(checkbox_package "mari0") Mari0 (aur)"
                    echo " 6) $(checkbox_package "neverball") Neverball"
                    echo " 7) $(checkbox_package "smc") Super Mario Chronicles"
                    echo " 8) $(checkbox_package "xmoto") X-Moto"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    ARCADE+=" b"
                    read_input_options "$ARCADE"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "opensonic"
                                ;;
                            2)
                                package_install "frogatto"
                                ;;
                            3)
                                package_install "bomberclone"
                                ;;
                            4)
                                aur_package_install "goonies"
                                ;;
                            5)
                                aur_package_install "mari0"
                                ;;
                            6)
                                package_install "neverball"
                                ;;
                            7)
                                package_install "smc"
                                ;;
                            8)
                                package_install "xmoto"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=2
                ;;
            3)
                #DUNGEON {{{
                while [[ 1 ]]
                do
                    print_title "DUNGEON"
                    echo " 1) $(checkbox_package "adom") Adom (aur)"
                    echo " 2) $(checkbox_package "tome4") Tales of MajEyal (aur)"
                    echo " 3) $(checkbox_package "lostlabyrinth") Lost Labyrinth (aur)"
                    echo " 4) $(checkbox_package "scourge") S.C.O.U.R.G.E. (aur)"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    DUNGEON+=" b"
                    read_input_options "$DUNGEON"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "adom"
                                ;;
                            2)
                                aur_package_install "tome4"
                                ;;
                            3)
                                aur_package_install "lostlabyrinth"
                                ;;
                            4)
                                aur_package_install "scourge"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=3
                ;;
            4)
                #EMULATORS {{{
                while [[ 1 ]]
                do
                    print_title "EMULATORS"
                    echo " 1) $(checkbox_package "bsnes") BSNES (aur)"
                    echo " 2) $(checkbox_package "desmume-svn") Desmume (aur)"
                    echo " 3) $(checkbox_package "dolphin-emu") Dolphin (aur)"
                    echo " 4) $(checkbox_package "epsxe") ePSXe (aur)"
                    echo " 5) $(checkbox_package "project64") Project64 (aur)"
                    echo " 6) $(checkbox_package "vba-m-gtk-svn") VisualBoyAdvanced (aur)"
                    echo " 7) $(checkbox_package "wxmupen64plus-hg") wxMupen64Plus (aur)"
                    echo " 8) $(checkbox_package "zsnes") ZSNES"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    EMULATORS+=" b"
                    read_input_options "$EMULATORS"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "bsnes"
                                ;;
                            2)
                                aur_package_install "desmume-svn"
                                ;;
                            3)
                                aur_package_install "dolphin-emu"
                                ;;
                            4)
                                aur_package_install "epsxe"
                                ;;
                            5)
                                aur_package_install "project64"
                                ;;
                            6)
                                aur_package_install "vba-m-gtk-svn"
                                ;;
                            7)
                                aur_package_install "wxmupen64plus-hg"
                                aur_package_install "mupen64plus-video-rice-hg"
                                aur_package_install "mupen64plus-audio-sdl-hg"
                                aur_package_install "mupen64plus-input-sdl-hg"
                                aur_package_install "mupen64plus-rsp-hle-hg"
                                ;;
                            8)
                                package_install "zsnes"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=4
                ;;
            5)
                #FPS {{{
                while [[ 1 ]]
                do
                    print_title "FPS"
                    echo " 1) $(checkbox_package "alienarena") AlienArena"
                    echo " 2) $(checkbox_package "warsow") Warsow"
                    echo " 3) $(checkbox_package "enemy-territory") Wolfenstein: Enemy Territory (aur)"
                    echo " 4) $(checkbox_package "worldofpadman") World of Padman (aur)"
                    echo " 5) $(checkbox_package "xonotic") Xonotic"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    FPS+=" b"
                    read_input_options "$FPS"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                package_install "alienarena"
                                ;;
                            2)
                                package_install "warsow"
                                ;;
                            3)
                                aur_package_install "enemy-territory"
                                ;;
                            4)
                                aur_package_install "worldofpadman"
                                ;;
                            5)
                                package_install "xonotic"
                                ;;

                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=5
                ;;
            6)
                #MMO {{{
                while [[ 1 ]]
                do
                    print_title "MMO"
                    echo " 1) $(checkbox_package "hon") Heroes of Newerth (aur)"
                    echo " 2) $(checkbox_package "manaplus") ManaPlus (aur)"
                    echo " 3) $(checkbox_package "savage2") Savage II (aur)"
                    echo " 4) $(checkbox_package "spiral-knights") Spiral Knights (aur)"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    MMO+=" b"
                    read_input_options "$MMO"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "hon"
                                ;;
                            2)
                                aur_package_install "manaplus"
                                ;;
                            3)
                                aur_package_install "savage2"
                                ;;
                            4)
                                aur_package_install "spiral-knights"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=6
                ;;
            7)
                #PUZZLE {{{
                while [[ 1 ]]
                do
                    print_title "PUZZLE"
                    echo " 1) $(checkbox_package "frozen-bubble") Frozen Bubble"
                    echo " 2) $(checkbox_package "numptyphysics-svn") Numptyphysics (aur)"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    PUZZLE+=" b"
                    read_input_options "$PUZZLE"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                package_install "frozen-bubble"
                                ;;
                            2)
                                aur_package_install "numptyphysics-svn"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=7
                ;;
            8)
                #RPG {{{
                while [[ 1 ]]
                do
                    print_title "RPG"
                    echo " 1) $(checkbox_package "ardentryst") Ardentryst (aur)"
                    echo " 2) $(checkbox_package "flare-rpg") Flare (aur)"
                    echo " 3) $(checkbox_package "freedroidrpg") Freedroid RPG"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    RPG+=" b"
                    read_input_options "$RPG"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "ardentryst"
                                ;;
                            2)
                                aur_package_install "flare-rpg"
                                ;;
                            3)
                                package_install "freedroidrpg"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=8
                ;;
            9)
                #RACING {{{
                while [[ 1 ]]
                do
                    print_title "RACING"
                    echo " 1) $(checkbox_package "maniadrive") Maniadrive (aur)"
                    echo " 2) $(checkbox_package "death-rally") Death Rally (aur)"
                    echo " 3) $(checkbox_package "stuntrally") Stuntrally (aur)"
                    echo " 4) $(checkbox_package "supertuxkart") SupertuxKart"
                    echo " 5) $(checkbox_package "speed-dreams") Speed Dreams"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    RACING+=" b"
                    read_input_options "$RACING"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                aur_package_install "maniadrive"
                                ;;
                            2)
                                aur_package_install "death-rally"
                                ;;
                            3)
                                aur_package_install "stuntrally"
                                ;;
                            4)
                                package_install "supertuxkart"
                                ;;
                            5)
                                package_install "speed-dreams"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=9
                ;;
            10)
                #SIMULATION {{{
                while [[ 1 ]]
                do
                    print_title "SIMULATION"
                    echo " 1) $(checkbox_package "simutrans") Simultrans"
                    echo " 2) $(checkbox_package "corsix-th") Theme Hospital (aur)"
                    echo " 3) $(checkbox_package "openttd") OpenTTD"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    SIMULATION+=" b"
                    read_input_options "$SIMULATION"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                package_install "simutrans"
                                ;;
                            2)
                                aur_package_install "corsix-th"
                                ;;
                            3)
                                package_install "openttd"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=10
                ;;
            11)
                #STRATEGY {{{
                while [[ 1 ]]
                do
                    print_title "STRATEGY"
                    echo " 1) $(checkbox_package "0ad") 0ad"
                    echo " 2) $(checkbox_package "hedgewars") Hedgewars"
                    echo " 3) $(checkbox_package "megaglest") MegaGlest"
                    echo " 4) $(checkbox_package "warzone2100") Warzone 2100"
                    echo " 5) $(checkbox_package "wesnoth") Wesnoth"
                    echo " 6) $(checkbox_package "zod") Zod (aur)"
                    echo ""
                    echo " b) BACK"
                    echo ""
                    STRATEGY+=" b"
                    read_input_options "$STRATEGY"
                    for OPT in ${OPTIONS[@]}; do
                        case "$OPT" in
                            1)
                                package_install "0ad"
                                ;;
                            2)
                                package_install "hedgewars"
                                ;;
                            3)
                                package_install "megaglest"
                                ;;
                            4)
                                package_install "warzone2100"
                                ;;
                            5)
                                package_install "wesnoth"
                                ;;
                            6)
                                aur_package_install "commander-zod"
                                ;;
                            "b")
                                break
                                ;;
                            *)
                                invalid_option
                                ;;
                        esac
                    done
                elihw
                done
                #}}}
                OPT=11
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#FONTS {{{
function install_fonts(){
while [[ 1 ]]
do
    print_title "FONTS - https://wiki.archlinux.org/index.php/Fonts"
    echo " 1) $(checkbox_package "ttf-dejavu") ttf-dejavu"
    echo " 2) $(checkbox_package "ttf-google-webfonts") ttf-google-webfonts (aur)"
    echo " 3) $(checkbox_package "ttf-kochi-substitute") ttf-kochi-substitute (Japanese Support) (aur)"
    echo " 4) $(checkbox_package "ttf-liberation") ttf-liberation"
    echo " 5) $(checkbox_package "ttf-ms-fonts") ttf-ms-fonts (aur)"
    echo " 6) $(checkbox_package "ttf-vista-fonts") ttf-vista-fonts (aur)"
    echo " 7) $(checkbox_package "ttf-mac-fonts") ttf-mac-fonts (aur)"
    echo ""
    echo " b) BACK"
    echo ""
    FONTS_OPTIONS+=" b"
    read_input_options "$FONTS_OPTIONS"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                package_install "ttf-dejavu"
                ;;
            2)
                echo -e "\nWARNING: Install time can be > 20min"
                read_input_text "Are you sure you want to continue?" $GOOGLE_FONTS
                if [[ $OPTION == n ]]; then continue; fi
                pacman -Rdd --noconfirm ttf-droid
                pacman -Rdd --noconfirm ttf-roboto
                pacman -Rdd --noconfirm ttf-ubuntu-font-family
                aur_package_install "ttf-google-webfonts"
                ;;
            3)
                aur_package_install "ttf-kochi-substitute"
                ;;
            4)
                package_install "ttf-liberation"
                ;;
            5)
                aur_package_install "ttf-ms-fonts"
                ;;
            6)
                aur_package_install "ttf-vista-fonts"
                ;;
            7)
                aur_package_install "ttf-mac-fonts"
                ;;
            "b")
                break
                ;;
            *)
                invalid_option
                ;;
        esac
    done
elihw
done
}
#}}}
#FONTS CONFIGURATION {{{
function configure_fonts(){
    print_title "FONTS CONFIGURATION - https://wiki.archlinux.org/index.php/Font_Configuration"
    echo " 1) Ubuntu patched packages"
    echo " 2) Cleartype patched packages"
    echo " 3) Infinality patched packages"
    echo " 4) Reverting to unpatched packages"
    echo ""
    echo " b) BACK"
    echo ""
    read_input $FONTSCONFIG_OPTION
    case "$OPTION" in
        1)
            pacman -Rdd --noconfirm cairo fontconfig freetype2 libxft
            aur_package_install "fontconfig-ubuntu freetype2-ubuntu libxft-ubuntu cairo-ubuntu"
            CURRENT_STATUS=1
            ;;
        2)
            pacman -Rdd --noconfirm cairo fontconfig freetype2 libxft
            aur_package_install "freetype2-cleartype libxft-cleartype cairo-cleartype"
            CURRENT_STATUS=1
            ;;
        3)
            pacman -Rdd --noconfirm fontconfig freetype2
            aur_package_install "freetype2-infinality fontconfig-infinality"
            /etc/profile.d/infinality-settings.sh
            infctl=("infinality" "linux" "osx" "osx2" "win7" "winxp")
            PS3="$prompt1"
            echo ""
            select OPT in "${infctl[@]}"; do
                if contains_element "$OPT" "${infctl[@]}"; then
                    /etc/fonts/infinality/infctl.sh setstyle $OPT
                    break
                else
                    invalid_option
                fi
            done
            CURRENT_STATUS=1
            ;;
        4)
            pacman -S --asdeps cairo fontconfig freetype2 libxft
            CURRENT_STATUS=1
            ;;
        *)
            CURRENT_STATUS=0
            ;;
    esac
    sumary "Patched Fonts Configuration installation"
    pause_function
}
#}}}
#CLEAN ORPHAN PACKAGES {{{
    function clean_orphan_packages(){
    print_title "CLEAN ORPHAN PACKAGES"
    pacman -Rsc --noconfirm $(pacman -Qqdt)
    #pacman -Sc --noconfirm
    pacman-optimize
}
#}}}
#FINISH {{{
function finish(){
    print_title "WARNING: PACKAGES INSTALLED FROM AUR"
    echo "List of packages not officially supported that may kill your cat:"
    pause_function
    pacman -Qm | awk '{print $1}' > aur_pkglist.txt
    more aur_pkglist.txt
    print_title "INSTALL COMPLETED"
    echo "Thanks for using the Archlinux Ultimate Install script by helmuthdu"
    pause_function
    if [[ $LXDE -eq 1 ]]; then
        DM="lxdm"
    elif [[ $XFCE -eq 1 || $OPENBOX -eq 1 ]]; then
        DM="slim"
    elif [[ $KDE -eq 1 ]]; then
        DM="kdm"
    else
        DM="gdm"
    fi
    [[ ! -n $DISPLAY ]] && start_daemon "$DM"
    exit 0
}
#}}}

#MAIN {{{
welcome
check_root
create_backup
language_selector
system_upgrade
select_user
choose_aurhelper

while [[ 1 ]]
do
    print_title "ARCHLINUX ULTIMATE INSTALL - https://github.com/helmuthdu/aui"
    echo " 1) $(checkbox $BASICSETUP) Basic Setup"
    echo " 2) $(checkbox $DESKTOPENVIRONMENT) Desktop Environment"
    echo " 3) $(checkbox $ACCESSORIES) Accessories Apps"
    echo " 4) $(checkbox $DEVELOPMENT) Development Apps"
    echo " 5) $(checkbox $OFFICE) Office Apps"
    echo " 6) $(checkbox $SYSTEM) System Apps"
    echo " 7) $(checkbox $GRAPHICS) Graphics Apps"
    echo " 8) $(checkbox $INTERNET) Internet Apps"
    echo " 9) $(checkbox $AUDIO) Audio Apps"
    echo "10) $(checkbox $VIDEO) Video Apps"
    echo "11) $(checkbox $GAMES) Games"
    echo "12) $(checkbox $LAMP) LAMP"
    echo "13) $(checkbox $FONTS) Fonts"
    echo "14) $(checkbox $FONTSCONFIG) Fonts Configuration"
    echo "15) $(checkbox $CLEANPACKAGES) Clean Orphan Packages"
    echo ""
    echo " q) Quit"
    echo ""
    MAINMENU+=" q"
    read_input_options "$MAINMENU"
    for OPT in ${OPTIONS[@]}; do
        case "$OPT" in
            1)
                custom_repositories
                rankmirror
                pacman_package_signing
                install_basic_setup
                install_tlp
                install_xorg
                install_video_cards
                install_cups
                install_additional_firmwares
                install_git_tor
                CURRENT_STATUS=1
                sumary "Basic setup installation"
                pause_function
                BASICSETUP=1
                ;;
            2)
                if [[ $BASICSETUP -eq 0 ]]; then
                    echo -e "\nWARNING: YOU MUST RUN THE BASIC SETUP FIRST"
                    read_input_text "Are you sure you want to continue?"
                    if [[ $OPTION == n ]]; then continue; fi
                fi
                install_desktop_environment
                install_nm_wicd
                DESKTOPENVIRONMENT=1
                ;;
            3)
                install_accessories_apps
                ACCESSORIES=1
                ;;
            4)
                install_development_apps
                DEVELOPMENT=1
                ;;
            5)
                install_office_apps
                OFFICE=1
                ;;
            6)
                install_system_apps
                SYSTEM=1
                ;;
            7)
                install_graphics_apps
                GRAPHICS=1
                ;;
            8)
                install_internet_apps
                INTERNET=1
                ;;
            9)
                install_audio_apps
                AUDIO=1
                ;;
            10)
                install_video_apps
                VIDEO=1
                ;;
            11)
                install_games
                GAMES=1
                ;;
            12)
                install_lamp
                LAMP=1
                ;;
            13)
                install_fonts
                FONTS=1
                ;;
            14)
                configure_fonts
                FONTSCONFIG=1
                ;;
            15)
                clean_orphan_packages
                CLEANPACKAGES=1
                ;;
            "q")
                finish
                ;;
            *)
                invalid_option
                ;;
        esac
    done
done
#}}}
